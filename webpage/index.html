<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OSU CSE Course Visualization</title>
    <script src="js\d3.v7.js"></script>
    <script src="js/dagre.js"></script>
    <script src="js/dagre-d3.js"></script>
    <link rel="stylesheet" href="css\style.css">
</head>
<body>
    <div class="main-container">
        <header>
            <svg class="site-title-container">
                <path class= "title-background" d="M 0 0 V 100 H 800 L 750 0 Z"/>
                <text class="title-text" x="30" y="90">CSE Course Visualization</text>
            </svg>
            <img class="site-logo" src="img\logo.png" alt="The Ohio State University College of Engineering">
        </header>
        <main>
            <div class="user-menu-container"></div>
                <label class="dropdown-label" for="specializations">Select a specialization:</label>
                <select class="dropdown-menu" name="specializations" id="specializations">
                    <option value="None"></option>
                    <option value="AIT">Artificial Intelligence</option>
                    <option value="CGG">Computer Graphics and Game Design</option>
                    <option value="DBA">Database Systems and Data Analytics</option>
                    <option value="ICA">Information and Computation Assurance</option>
                    <option value="CNT">Computer Networking</option>
                    <option value="CSY">Computer Systems</option>
                    <option value="SWS">Software Engineering</option>
                </select>
            <div class="graph-container">
                <svg id="course-graph" ></svg>
            </div>
        </main>
        <footer>
            <p class="auth-info">Authors:<br>
                Saul Ibaven - ibavenbueno.1@buckeyemail.osu.edu<br>
                Chris Stanulet - stanulet.1@buckeyemail.osu.edu
            </p>
        </footer>
    </div>
    <script type="text/javascript">
            //Main app definition
            var app = async function () 
            {
                //Load Json files
                var specializaitonsData = await d3.json("data/CSE_Courses_Specialization.json");
                //console.log(specializaitonData);

                //Read the specialization selected 
                var specializationDropdown = document.getElementById("specializations");
                specializationDropdown.addEventListener('change', function handleChange(){

                    //--------------- Draw graph everytime that selection is changed --------------------------
                    //Read the new selection
                    var selectedSpecialization = specializationDropdown.value

                    //Select the svg where the graph will be drawn
                    const svgCourseGraph = d3.select("#course-graph");

                    //If None is selected, clear all graphics
                    if(selectedSpecialization != "None")
                    {
                        //Get only the values of the selected specialization
                        const selectedSpecializationCourses = [];

                        specializaitonsData.forEach(element => {
                            if(element.Type == selectedSpecialization)
                            {
                                //console.log(element.Number);
                                selectedSpecializationCourses.push(element)
                            }  
                        });

                        console.log(selectedSpecializationCourses);

                        // ---------------------------------------------- DAG Creation --------------------------------------------------
                        var g = new dagreD3.graphlib.Graph({compound:true})
                                                    .setGraph({})
                                                    .setDefaultEdgeLabel(function() { return {}; });

                        // Setting the nodes
                        selectedSpecializationCourses.forEach(course => 
                        {
                            g.setNode(course.Number,{label : course.Number, description : course.Title});

                        })

                        g.nodes().forEach(function(v) 
                        {
                            var node = g.node(v);
                            // Round the corners of the nodes
                            node.rx = node.ry = 5;
                        });

                        // Create the renderer
                        var render = new dagreD3.render();

                        // Set up an SVG group so that we can translate the final graph.
                        svgGroup = svgCourseGraph.append("g");


                        // Run the renderer. This is what draws the final graph.
                        render(svgCourseGraph.select("g"), g);


                        // svgHeight = document.getElementById("course-graph").clientHeight;
                        // svgWidth = document.getElementById("course-graph").clientWidth;
                        // svgGroup.attr("transform","translate("+ svgWidth/2 + "," + svgHeight/2 + ")");



                        // ---------------------------------------------------------------------------------------------------------------

                        
            

                    }
                })
                
            }
            app();
    </script>
</body>
</html>